<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>আলমার সেবা</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100">

<script>
    // ------------------ Firebase Config ------------------
    const firebaseConfig = {
        apiKey: "AIzaSyBgpbx7dtJl9beKWx7BB0-w0C5sG-FgLvY",
        authDomain: "amar-sheba-ea1ba.firebaseapp.com",
        projectId: "amar-sheba-ea1ba",
        storageBucket: "amar-sheba-ea1ba.firebasestorage.app",
        messagingSenderId: "563271616190",
        appId: "1:563271616190:web:8abf8874c75121696440ef",
        measurementId: "G-XZ778FPRX1"
    };

    // Firebase Initialize
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // গ্লোবাল ভেরিয়েবল
    let currentUser = null;
    let userBalance = 0;
</script>

<!-- App Container -->
<div id="app" class="max-w-md mx-auto bg-white min-h-screen shadow-lg relative"></div>

<script>
    const app = document.getElementById('app');

    // ---------- লগইন পেজ (আলাদা) ----------
    function renderLoginPage() {
        app.innerHTML = `
            <div class="min-h-screen bg-gradient-to-br from-blue-600 to-sky-400 flex items-center justify-center p-4">
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl w-full max-w-md p-8">
                    <!-- লোগো ও হেডার -->
                    <div class="text-center mb-8">
                        <div class="bg-blue-600 w-20 h-20 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg">
                            <i class="fas fa-hand-holding-heart text-white text-4xl"></i>
                        </div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">আলমার সেবা</h1>
                        <p class="text-gray-500">আপনার বিশ্বস্ত অনলাইন সেবা প্রদানকারী</p>
                    </div>

                    <!-- ফর্ম কার্ড -->
                    <div class="bg-gray-50 rounded-xl p-6 shadow-inner">
                        <h2 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-lock text-blue-600 mr-2"></i>
                            লগইন করুন
                        </h2>
                        
                        <!-- ইনপুট ফিল্ডস -->
                        <div class="space-y-4">
                            <div class="relative">
                                <i class="fas fa-phone-alt absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="login-phone" placeholder="মোবাইল নাম্বার" 
                                    class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
                            </div>
                            
                            <div class="relative">
                                <i class="fas fa-key absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="password" id="login-password" placeholder="পাসওয়ার্ড" 
                                    class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
                            </div>
                        </div>

                        <!-- বাটন -->
                        <div class="mt-6">
                            <button onclick="handleLogin()" 
                                class="w-full bg-gradient-to-r from-blue-600 to-sky-500 text-white py-3 rounded-lg font-semibold shadow-md hover:shadow-lg">
                                <i class="fas fa-sign-in-alt mr-2"></i>
                                লগইন করুন
                            </button>
                            
                            <p class="text-center mt-4 text-gray-600">
                                নতুন ব্যবহারকারী? 
                                <button onclick="showRegisterPage()" class="text-blue-600 font-semibold hover:underline">
                                    রেজিস্টার করুন
                                </button>
                            </p>
                        </div>

                        <!-- হেল্প টেক্সট -->
                        <p class="text-xs text-center text-gray-400 mt-6">
                            <i class="fas fa-shield-alt mr-1"></i>
                            আপনার তথ্য ১০০% নিরাপদ
                        </p>
                    </div>

                    <!-- ফুটার -->
                    <div class="text-center mt-6">
                        <p class="text-sm text-gray-500">
                            <i class="fas fa-phone mr-1"></i>
                            জরুরি প্রয়োজনে: 01753119223
                        </p>
                    </div>
                </div>
            </div>
        `;
    }

    // ---------- রেজিস্টার পেজ (আলাদা) ----------
    function showRegisterPage() {
        app.innerHTML = `
            <div class="min-h-screen bg-gradient-to-br from-blue-600 to-sky-400 flex items-center justify-center p-4">
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl w-full max-w-md p-8">
                    <!-- লোগো ও হেডার -->
                    <div class="text-center mb-8">
                        <div class="bg-green-600 w-20 h-20 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg">
                            <i class="fas fa-user-plus text-white text-4xl"></i>
                        </div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">নতুন অ্যাকাউন্ট</h1>
                        <p class="text-gray-500">রেজিস্ট্রেশন করুন</p>
                    </div>

                    <!-- ফর্ম কার্ড -->
                    <div class="bg-gray-50 rounded-xl p-6 shadow-inner">
                        <h2 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-user text-green-600 mr-2"></i>
                            রেজিস্ট্রেশন ফর্ম
                        </h2>
                        
                        <!-- ইনপুট ফিল্ডস -->
                        <div class="space-y-4">
                            <div class="relative">
                                <i class="fas fa-phone-alt absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="reg-phone" placeholder="মোবাইল নাম্বার" 
                                    class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                            </div>
                            
                            <div class="relative">
                                <i class="fas fa-key absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="password" id="reg-password" placeholder="পাসওয়ার্ড" 
                                    class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                            </div>

                            <div class="relative">
                                <i class="fas fa-key absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="password" id="reg-confirm-password" placeholder="পাসওয়ার্ড নিশ্চিত করুন" 
                                    class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                            </div>
                        </div>

                        <!-- বাটন -->
                        <div class="mt-6">
                            <button onclick="handleRegister()" 
                                class="w-full bg-gradient-to-r from-green-600 to-green-500 text-white py-3 rounded-lg font-semibold shadow-md hover:shadow-lg">
                                <i class="fas fa-user-plus mr-2"></i>
                                রেজিস্টার করুন
                            </button>
                            
                            <p class="text-center mt-4 text-gray-600">
                                ইতিমধ্যে অ্যাকাউন্ট আছে? 
                                <button onclick="renderLoginPage()" class="text-blue-600 font-semibold hover:underline">
                                    লগইন করুন
                                </button>
                            </p>
                        </div>

                        <!-- হেল্প টেক্সট -->
                        <p class="text-xs text-center text-gray-400 mt-6">
                            <i class="fas fa-shield-alt mr-1"></i>
                            আপনার তথ্য ১০০% নিরাপদ
                        </p>
                    </div>

                    <!-- ফুটার -->
                    <div class="text-center mt-6">
                        <p class="text-sm text-gray-500">
                            <i class="fas fa-phone mr-1"></i>
                            জরুরি প্রয়োজনে: 01753119223
                        </p>
                    </div>
                </div>
            </div>
        `;
    }

    // ---------- হোমপেজ ----------
    function renderHomePage() {
        app.innerHTML = `
            <div>
                <!-- মেনু বার -->
                <div class="bg-gradient-to-r from-blue-700 to-sky-600 text-white p-4 flex justify-between items-center shadow-lg">
                    <i class="fas fa-bars text-2xl cursor-pointer hover:opacity-80" onclick="toggleMenu()"></i>
                    <h1 class="text-xl font-bold tracking-wide">আলমার সেবা</h1>
                    <i class="fas fa-user-circle text-2xl cursor-pointer hover:opacity-80" onclick="showUserProfile()"></i>
                </div>

                <!-- সাইড মেনু (ডিফল্টভাবে লুকানো) -->
                <div id="sideMenu" class="fixed left-0 top-0 h-full w-64 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300">
                    <div class="bg-gradient-to-r from-blue-700 to-sky-600 text-white p-4">
                        <h2 class="font-bold">মেনু</h2>
                        <button onclick="toggleMenu()" class="absolute top-4 right-4 text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="py-2 hover:bg-gray-100 px-2 rounded cursor-pointer" onclick="goToServices()">
                            <i class="fas fa-list text-blue-600 mr-2"></i> সার্ভিস সমূহ
                        </div>
                        <div class="py-2 hover:bg-gray-100 px-2 rounded cursor-pointer" onclick="goToOrders()">
                            <i class="fas fa-shopping-bag text-blue-600 mr-2"></i> আমার অর্ডার
                        </div>
                        <div class="py-2 hover:bg-gray-100 px-2 rounded cursor-pointer" onclick="goToProfile()">
                            <i class="fas fa-user text-blue-600 mr-2"></i> প্রোফাইল
                        </div>
                        <div class="py-2 hover:bg-gray-100 px-2 rounded cursor-pointer" onclick="handleLogout()">
                            <i class="fas fa-sign-out-alt text-red-600 mr-2"></i> লগআউট
                        </div>
                    </div>
                </div>

                <!-- মেনু ওপেন করার ওভারলে -->
                <div id="menuOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40" onclick="toggleMenu()"></div>

                <!-- ব্যালেন্স ও অ্যাড মানি -->
                <div class="bg-gradient-to-br from-blue-500 to-sky-400 text-white p-6 shadow-inner">
                    <div class="text-center">
                        <p class="text-sm opacity-90 mb-1">বর্তমান ব্যালেন্স</p>
                        <p class="text-4xl font-bold mb-4" id="balanceDisplay">৳ 0</p>
                        <button onclick="showAddMoneyModal()" class="bg-white text-blue-600 px-8 py-2 rounded-full font-semibold shadow-lg hover:shadow-xl">
                            <i class="fas fa-plus-circle mr-1"></i>Add Money
                        </button>
                    </div>
                </div>

                <!-- অর্ডার সমূহ -->
                <div class="p-4 border-b bg-gray-50">
                    <h2 class="font-semibold text-gray-700 mb-2 flex items-center">
                        <i class="fas fa-shopping-bag text-blue-600 mr-2"></i>
                        অর্ডার সমূহ
                    </h2>
                    <div id="ordersList" class="text-sm text-gray-500">
                        <p class="text-center py-3 bg-white rounded-lg shadow-sm">কোন অর্ডার নেই</p>
                    </div>
                </div>

                <!-- WhatsApp বাটন -->
                <div class="p-4">
                    <a href="https://wa.me/8801753119223" target="_blank" class="flex items-center justify-center bg-green-500 text-white p-3 rounded-lg shadow-md hover:shadow-lg">
                        <i class="fab fa-whatsapp text-2xl mr-2"></i>
                        <span class="font-semibold">01753119223 - WhatsApp এ যোগাযোগ</span>
                    </a>
                </div>

                <!-- সার্ভিস লিস্ট -->
                <div class="p-4">
                    <h2 class="font-semibold text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-list text-blue-600 mr-2"></i>
                        সার্ভিস সমূহ
                    </h2>
                    <div class="space-y-2" id="servicesList"></div>
                </div>
            </div>
        `;
        
        // ক্লিক হ্যান্ডলার ঠিক করার জন্য setTimeout
        setTimeout(() => {
            loadServices();
            loadUserBalance();
            loadOrders();
        }, 100);
    }

    // ---------- মেনু টগল ফাংশন ----------
    window.toggleMenu = function() {
        const menu = document.getElementById('sideMenu');
        const overlay = document.getElementById('menuOverlay');
        if (menu.classList.contains('-translate-x-full')) {
            menu.classList.remove('-translate-x-full');
            overlay.classList.remove('hidden');
        } else {
            menu.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        }
    };

    // ---------- লগইন হ্যান্ডলার (ইমেইল ফরম্যাট ঠিক করা) ----------
    window.handleLogin = async function() {
        const phone = document.getElementById('login-phone').value;
        const password = document.getElementById('login-password').value;
        
        if (!phone || !password) {
            alert('ফোন ও পাসওয়ার্ড দিন');
            return;
        }
        
        // ফোন নাম্বার থেকে ইমেইল তৈরি (সঠিক ফরম্যাট)
        const email = phone.trim() + '@almar-seba.com';
        
        try {
            await auth.signInWithEmailAndPassword(email, password);
            
            if (phone === '01828407381') {
                renderAdminPanel();
            } else {
                renderHomePage();
            }
        } catch (error) {
            alert('লগইন ব্যর্থ: ' + error.message);
        }
    };

    // ---------- রেজিস্টার হ্যান্ডলার ----------
    window.handleRegister = async function() {
        const phone = document.getElementById('reg-phone').value;
        const password = document.getElementById('reg-password').value;
        const confirmPass = document.getElementById('reg-confirm-password').value;
        
        if (!phone || !password || !confirmPass) {
            alert('সব তথ্য দিন');
            return;
        }
        
        if (password !== confirmPass) {
            alert('পাসওয়ার্ড মিলছে না');
            return;
        }
        
        const email = phone.trim() + '@almar-seba.com';
        
        try {
            const result = await auth.createUserWithEmailAndPassword(email, password);
            
            await db.collection('users').doc(result.user.uid).set({
                phone: phone,
                email: email,
                balance: 0,
                createdAt: new Date()
            });
            
            alert('রেজিস্ট্রেশন সফল! এখন লগইন করুন');
            renderLoginPage();
        } catch (error) {
            alert('রেজিস্ট্রেশন ব্যর্থ: ' + error.message);
        }
    };

    // ---------- লগআউট ----------
    window.handleLogout = async function() {
        await auth.signOut();
        renderLoginPage();
    };

    // ---------- অ্যাড মানি মোডাল ----------
    window.showAddMoneyModal = function() {
        const modalHtml = `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" id="modal">
                <div class="bg-white rounded-2xl p-6 w-full max-w-md">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">অ্যাড মানি</h3>
                    
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-600 mb-1">বিকাশ পার্সোনাল</p>
                        <p class="text-lg font-bold text-blue-600">01828407381</p>
                        <button onclick="copyNumber()" class="text-blue-500 text-sm mt-1 hover:underline">
                            <i class="far fa-copy mr-1"></i>নাম্বার কপি করুন
                        </button>
                    </div>
                    
                    <input type="number" id="amount" placeholder="পরিমাণ (টাকা)" class="w-full p-3 border rounded-lg mb-3">
                    <input type="text" id="trxId" placeholder="ট্রানজেকশন আইডি" class="w-full p-3 border rounded-lg mb-4">
                    
                    <button onclick="submitMoneyRequest()" class="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 mb-2">
                        সাবমিট রিকোয়েস্ট
                    </button>
                    <button onclick="closeModal()" class="w-full bg-gray-200 text-gray-700 p-3 rounded-lg font-semibold hover:bg-gray-300">
                        বন্ধ করুন
                    </button>
                </div>
            </div>
        `;
        
        // পুরোনো মোডাল রিমুভ করে নতুন যোগ
        const oldModal = document.getElementById('modal');
        if (oldModal) oldModal.remove();
        
        app.insertAdjacentHTML('beforeend', modalHtml);
    };

    window.copyNumber = function() {
        navigator.clipboard.writeText('01828407381');
        alert('নাম্বার কপি হয়েছে!');
    };

    window.closeModal = function() {
        const modal = document.getElementById('modal');
        if (modal) modal.remove();
    };

    window.submitMoneyRequest = async function() {
        const amount = document.getElementById('amount').value;
        const trxId = document.getElementById('trxId').value;
        
        if (!amount || !trxId) return alert('সব তথ্য দিন');
        if (!currentUser) return alert('লগইন প্রয়োজন');
        
        await db.collection('moneyRequests').add({
            userId: currentUser.uid,
            userPhone: currentUser.email.split('@')[0],
            amount: parseInt(amount),
            transactionId: trxId,
            status: 'pending',
            timestamp: new Date()
        });
        
        alert('রিকোয়েস্ট পাঠানো হয়েছে');
        closeModal();
    };

    // ---------- সার্ভিস লোড ----------
    async function loadServices() {
        const services = [
            { id: 1, name: 'NID নাম্বার টু PDF', icon: 'fa-id-card' },
            { id: 2, name: 'সার্ভার কপি', icon: 'fa-copy' },
            { id: 3, name: 'নতুন জন্মনিবন্ধন', icon: 'fa-baby' },
            { id: 4, name: 'জন্মনিবন্ধন নাম্বার পরিবর্তন', icon: 'fa-edit' },
            { id: 5, name: 'জন্মনিবন্ধন সংশোধন', icon: 'fa-pen' },
            { id: 6, name: 'NID সংশোধন', icon: 'fa-user-edit' },
            { id: 7, name: 'নতুন টিন সার্টিফিকেট', icon: 'fa-file-invoice' },
            { id: 8, name: 'ই-রিটার্ন', icon: 'fa-chart-line' },
            { id: 9, name: 'ফোন নাম্বার টু এনআইডি', icon: 'fa-mobile-alt' }
        ];

        let html = '';
        services.forEach(service => {
            html += `
                <div onclick="showServiceDetails('${service.id}')" class="flex items-center p-3 bg-white rounded-lg shadow-sm hover:shadow-md cursor-pointer border border-gray-100">
                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas ${service.icon} text-blue-600"></i>
                    </div>
                    <span class="flex-1 font-medium">${service.name}</span>
                    <span class="text-blue-600 font-bold">১০০৳</span>
                    <i class="fas fa-chevron-right text-gray-400 ml-2"></i>
                </div>
            `;
        });
        
        const servicesList = document.getElementById('servicesList');
        if (servicesList) servicesList.innerHTML = html;
    }

    async function loadUserBalance() {
        if (!currentUser) return;
        const doc = await db.collection('users').doc(currentUser.uid).get();
        if (doc.exists) {
            userBalance = doc.data().balance || 0;
            const balanceDisplay = document.getElementById('balanceDisplay');
            if (balanceDisplay) balanceDisplay.textContent = `৳ ${userBalance}`;
        }
    }

    window.showServiceDetails = function(serviceId) {
        alert('সার্ভিস ডিটেইলস পেজ (পরবর্তীতে যুক্ত হবে)');
    };

    // ---------- মেনু ফাংশন ----------
    window.goToServices = function() {
        toggleMenu();
        document.getElementById('servicesList').scrollIntoView({ behavior: 'smooth' });
    };

    window.goToOrders = function() {
        toggleMenu();
        alert('অর্ডার পেজ (পরবর্তীতে যুক্ত হবে)');
    };

    window.goToProfile = function() {
        toggleMenu();
        alert('প্রোফাইল পেজ (পরবর্তীতে যুক্ত হবে)');
    };

    // ---------- অ্যাডমিন প্যানেল (সংক্ষেপে) ----------
    function renderAdminPanel() {
        app.innerHTML = `
            <div class="min-h-screen bg-gray-100">
                <div class="bg-gradient-to-r from-blue-700 to-sky-600 text-white p-4 shadow-lg">
                    <h1 class="text-xl font-bold text-center">এডমিন প্যানেল</h1>
                </div>
                <div class="p-4">
                    <p class="text-center py-8">এডমিন প্যানেল লোড হচ্ছে...</p>
                </div>
            </div>
        `;
        // এডমিন ফাংশন পরে ইমপ্লিমেন্ট করব
    }

    // ---------- অথ স্টেট চেক ----------
    auth.onAuthStateChanged(async (user) => {
        if (user) {
            currentUser = user;
            const phone = user.email.split('@')[0];
            
            if (phone === '01828407381') {
                renderAdminPanel();
            } else {
                renderHomePage();
            }
        } else {
            renderLoginPage();
        }
    });

    // উইন্ডোতে ফাংশনগুলো এক্সপোজ করা
    window.renderLoginPage = renderLoginPage;
    window.showRegisterPage = showRegisterPage;
</script>

<!-- কাস্টম অ্যানিমেশন -->
<style>
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .animate-fade-in {
        animation: fadeIn 0.3s ease-in-out;
    }
    
    ::-webkit-scrollbar {
        width: 6px;
    }
    
    ::-webkit-scrollbar-track {
        background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
</style>
</body>
</html>
